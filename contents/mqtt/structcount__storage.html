<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mqtt_cpp: count_storage&lt; N &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mqtt_cpp
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">count_storage&lt; N &gt; Struct Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="subscription__map_8hpp_source.html">subscription_map.hpp</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;std::size_t N&gt;<br />
struct count_storage&lt; N &gt;</h3>

<p>In MQTT we have: Clients subscribed with certain topic filters, topic filters are path with may contain wildcards such as</p><ul>
<li>and # . A subscription to "#" will not receive any messages published to a topic beginning with a $ · A subscription to "+/monitor/Clients" will not receive any messages published to "$SYS/monitor/Clients" · A subscription to "$SYS/#" will receive messages published to topics beginning with "$SYS/" · A subscription to "$SYS/monitor/Clients/+" will receive messages published to "$SYS/monitor/Clients/" · For a Client to receive messages from topics that begin with $SYS/ and from topics that don’t begin with a $, it has to subscribe to both “::” and “$SYS/#” Check whether a string is a valid subscription using 'mqtt_valid_subscription'</li>
</ul>
<p>Topics being published, a topic is a sort of path and does not contain wildcards · $SYS/ has been widely adopted as a prefix to topics that contain Server-specific information or control APIs · Applications cannot use a topic with a leading $ character for their own purposes Check whether a string is a valid topic using 'mqtt_valid_topic'</p>
<p>We introduce two data structures: . A subscription map, storing a topic_filter -&gt; data Using a published topic, we can find all topic filters which match the specified topic . A stored topic map, storing topic -&gt; data Using a new topic filter, we can find all stored topics which match the specified topic filter</p>
<p>Subscription map stores all entries in a tree the tree starts from a root node, and topic filters are tokenized and stored in the tree</p>
<p>For example if the topic_filter example/monitor/Clients is stored, the following nodes are created: root -&gt; example -&gt; monitor -&gt; Clients</p>
<p>Every node in the tree may store one or multiple subscribers. Nodes store a reference count to the number of subscribers so for example, if we store the following topic_filters: example/ example/monitor/Clients</p>
<p>the subscription map looks as follows: root(2) -&gt; example(2) -&gt; monitor(1) -&gt; Clients (1)</p>
<p>hash and + are stored as normal nodes within the tree, but the parent node knows if a hash child is available. This improves the matching, no extra lookup is required to see if a # or + child is available in a child node:</p>
<p>example/#</p>
<p>stores the following tree: root -&gt; example (hash: yes) -&gt; #</p>
<p>and</p>
<p>example/+</p>
<p>stores the following tree: root -&gt; example (plus: yes) -&gt; #</p>
<p>all node entries are stored in a single hash map. The key for every node is: (parent node id, path)</p>
<p>so if we store: root/example/test root (id:1) -&gt; example (id:2, key:1,example) -&gt; test (id:3, key:2,test)</p>
<p>also, every node stores the key of its parent, allowing quick traversing from leaf to root of the tree </p>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>/home/kondo/work/mqtt_cpp/include/mqtt/broker/<a class="el" href="subscription__map_8hpp_source.html">subscription_map.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
